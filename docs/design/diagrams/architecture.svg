<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg width="880" height="620" version="1.1"
     xmlns="http://www.w3.org/2000/svg">

  <!-- Background -->
  <rect width="880" height="620" fill="#f8f9fa" rx="8"/>

  <!-- Title -->
  <text x="440" y="32" font-family="Inter, Arial, sans-serif" font-size="18"
        text-anchor="middle" font-weight="bold" fill="#1a1a2e">FusionXPay Architecture</text>

  <!-- ==================== Layer 1: Gateway ==================== -->
  <rect x="240" y="56" width="400" height="56" rx="8"
        fill="#ede7f6" stroke="#7c4dff" stroke-width="2"/>
  <text x="440" y="82" font-family="Inter, Arial, sans-serif" font-size="14"
        text-anchor="middle" font-weight="bold" fill="#4a148c">API Gateway</text>
  <text x="440" y="100" font-family="Inter, Arial, sans-serif" font-size="11"
        text-anchor="middle" fill="#7c4dff">Rate Limiting  ·  API Key Auth  ·  RBAC</text>

  <!-- Gateway port label -->
  <text x="648" y="90" font-family="monospace" font-size="10"
        fill="#9e9e9e">:8080</text>

  <!-- ==================== Layer 2: Services ==================== -->

  <!-- Order Service -->
  <rect x="40" y="175" width="160" height="56" rx="8"
        fill="#e3f2fd" stroke="#1976d2" stroke-width="2"/>
  <text x="120" y="200" font-family="Inter, Arial, sans-serif" font-size="13"
        text-anchor="middle" font-weight="bold" fill="#0d47a1">Order Service</text>
  <text x="120" y="218" font-family="Inter, Arial, sans-serif" font-size="10"
        text-anchor="middle" fill="#1976d2">Merchant Isolation</text>
  <text x="208" y="206" font-family="monospace" font-size="10" fill="#9e9e9e">:8082</text>

  <!-- Payment Service -->
  <rect x="250" y="175" width="160" height="56" rx="8"
        fill="#e8f5e9" stroke="#388e3c" stroke-width="2"/>
  <text x="330" y="200" font-family="Inter, Arial, sans-serif" font-size="13"
        text-anchor="middle" font-weight="bold" fill="#1b5e20">Payment Service</text>
  <text x="330" y="218" font-family="Inter, Arial, sans-serif" font-size="10"
        text-anchor="middle" fill="#388e3c">Stripe · PayPal</text>
  <text x="418" y="206" font-family="monospace" font-size="10" fill="#9e9e9e">:8081</text>

  <!-- Admin Service -->
  <rect x="460" y="175" width="160" height="56" rx="8"
        fill="#fff3e0" stroke="#f57c00" stroke-width="2"/>
  <text x="540" y="200" font-family="Inter, Arial, sans-serif" font-size="13"
        text-anchor="middle" font-weight="bold" fill="#e65100">Admin Service</text>
  <text x="540" y="218" font-family="Inter, Arial, sans-serif" font-size="10"
        text-anchor="middle" fill="#f57c00">JWT Auth</text>
  <text x="628" y="206" font-family="monospace" font-size="10" fill="#9e9e9e">:8084</text>

  <!-- Notification Service -->
  <rect x="670" y="175" width="170" height="56" rx="8"
        fill="#fce4ec" stroke="#c62828" stroke-width="2"/>
  <text x="755" y="200" font-family="Inter, Arial, sans-serif" font-size="13"
        text-anchor="middle" font-weight="bold" fill="#b71c1c">Notification Service</text>
  <text x="755" y="218" font-family="Inter, Arial, sans-serif" font-size="10"
        text-anchor="middle" fill="#c62828">Async Events</text>
  <text x="848" y="206" font-family="monospace" font-size="10" fill="#9e9e9e">:8083</text>

  <!-- ==================== Gateway → Services arrows ==================== -->
  <!-- GW → Order -->
  <line x1="320" y1="112" x2="120" y2="175" stroke="#5c6bc0" stroke-width="1.5"/>
  <polygon points="124,170 116,170 120,179" fill="#5c6bc0"/>

  <!-- GW → Payment -->
  <line x1="390" y1="112" x2="330" y2="175" stroke="#5c6bc0" stroke-width="1.5"/>
  <polygon points="334,170 326,170 330,179" fill="#5c6bc0"/>

  <!-- GW → Admin -->
  <line x1="490" y1="112" x2="540" y2="175" stroke="#5c6bc0" stroke-width="1.5"/>
  <polygon points="544,170 536,170 540,179" fill="#5c6bc0"/>

  <!-- GW → Notification -->
  <line x1="560" y1="112" x2="755" y2="175" stroke="#5c6bc0" stroke-width="1.5"/>
  <polygon points="759,170 751,170 755,179" fill="#5c6bc0"/>

  <!-- ==================== Inter-service calls ==================== -->

  <!-- Payment → Order (Feign: update status) -->
  <line x1="250" y1="195" x2="200" y2="195" stroke="#1976d2" stroke-width="1.5"
        stroke-dasharray="6,3"/>
  <polygon points="205,191 197,195 205,199" fill="#1976d2"/>
  <text x="225" y="189" font-family="Inter, Arial, sans-serif" font-size="9"
        text-anchor="middle" fill="#1976d2">Feign</text>

  <!-- Admin → Order (REST: query orders) -->
  <path d="M 460,215 Q 350,260 200,215" stroke="#f57c00" stroke-width="1.5"
        stroke-dasharray="6,3" fill="none"/>
  <polygon points="205,211 197,215 205,219" fill="#f57c00"/>
  <text x="340" y="253" font-family="Inter, Arial, sans-serif" font-size="9"
        text-anchor="middle" fill="#f57c00">REST (query orders)</text>

  <!-- ==================== Layer 3: Kafka ==================== -->
  <rect x="200" y="300" width="480" height="50" rx="8"
        fill="#fff8e1" stroke="#ff8f00" stroke-width="2"/>
  <text x="440" y="322" font-family="Inter, Arial, sans-serif" font-size="13"
        text-anchor="middle" font-weight="bold" fill="#e65100">Apache Kafka</text>
  <text x="440" y="340" font-family="monospace" font-size="10"
        text-anchor="middle" fill="#ff8f00">topic: payment-events</text>

  <!-- Payment → Kafka (produce) -->
  <line x1="330" y1="231" x2="330" y2="300" stroke="#ff8f00" stroke-width="1.5"/>
  <polygon points="326,295 334,295 330,304" fill="#ff8f00"/>
  <text x="345" y="270" font-family="Inter, Arial, sans-serif" font-size="9"
        fill="#ff8f00" font-style="italic">produce</text>

  <!-- Kafka → Order (consume) -->
  <line x1="300" y1="300" x2="140" y2="231" stroke="#1976d2" stroke-width="1.5"/>
  <polygon points="144,236 136,236 140,227" fill="#1976d2"/>
  <text x="200" y="272" font-family="Inter, Arial, sans-serif" font-size="9"
        fill="#1976d2" font-style="italic">consume</text>

  <!-- Kafka → Notification (consume) -->
  <line x1="580" y1="300" x2="740" y2="231" stroke="#c62828" stroke-width="1.5"/>
  <polygon points="744,236 736,236 740,227" fill="#c62828"/>
  <text x="680" y="272" font-family="Inter, Arial, sans-serif" font-size="9"
        fill="#c62828" font-style="italic">consume</text>

  <!-- ==================== Layer 4: Data Stores ==================== -->

  <!-- MySQL -->
  <ellipse cx="260" cy="430" rx="80" ry="14" fill="#bbdefb" stroke="#1565c0" stroke-width="2"/>
  <rect x="180" y="430" width="160" height="30" fill="#bbdefb" stroke="none"/>
  <ellipse cx="260" cy="460" rx="80" ry="14" fill="#bbdefb" stroke="#1565c0" stroke-width="2"/>
  <line x1="180" y1="430" x2="180" y2="460" stroke="#1565c0" stroke-width="2"/>
  <line x1="340" y1="430" x2="340" y2="460" stroke="#1565c0" stroke-width="2"/>
  <text x="260" y="450" font-family="Inter, Arial, sans-serif" font-size="13"
        text-anchor="middle" font-weight="bold" fill="#0d47a1">MySQL</text>
  <text x="260" y="490" font-family="Inter, Arial, sans-serif" font-size="10"
        text-anchor="middle" fill="#1565c0">All services share one database</text>
  <text x="348" y="450" font-family="monospace" font-size="10" fill="#9e9e9e">:3306</text>

  <!-- Redis -->
  <rect x="500" y="420" width="160" height="54" rx="8"
        fill="#ffebee" stroke="#d32f2f" stroke-width="2"/>
  <text x="580" y="445" font-family="Inter, Arial, sans-serif" font-size="13"
        text-anchor="middle" font-weight="bold" fill="#b71c1c">Redis</text>
  <text x="580" y="462" font-family="Inter, Arial, sans-serif" font-size="10"
        text-anchor="middle" fill="#d32f2f">Rate Limit · Idempotency</text>
  <text x="668" y="450" font-family="monospace" font-size="10" fill="#9e9e9e">:6379</text>

  <!-- Services → MySQL -->
  <line x1="120" y1="231" x2="220" y2="420" stroke="#1565c0" stroke-width="1" stroke-dasharray="4,3"/>
  <line x1="330" y1="350" x2="270" y2="420" stroke="#1565c0" stroke-width="1" stroke-dasharray="4,3"/>
  <line x1="540" y1="231" x2="290" y2="420" stroke="#1565c0" stroke-width="1" stroke-dasharray="4,3"/>
  <line x1="755" y1="231" x2="310" y2="420" stroke="#1565c0" stroke-width="1" stroke-dasharray="4,3"/>

  <!-- GW → Redis -->
  <line x1="580" y1="112" x2="580" y2="420" stroke="#d32f2f" stroke-width="1" stroke-dasharray="4,3"/>

  <!-- Payment → Redis -->
  <line x1="380" y1="231" x2="530" y2="420" stroke="#d32f2f" stroke-width="1" stroke-dasharray="4,3"/>

  <!-- ==================== Layer 5: Monitoring ==================== -->
  <rect x="200" y="540" width="480" height="44" rx="8"
        fill="#e8eaf6" stroke="#3f51b5" stroke-width="1.5"/>
  <text x="440" y="566" font-family="Inter, Arial, sans-serif" font-size="12"
        text-anchor="middle" font-weight="bold" fill="#283593">Prometheus  ·  Grafana  ·  Loki  ·  Promtail</text>

  <!-- Monitoring dashed connections -->
  <line x1="260" y1="495" x2="350" y2="540" stroke="#7986cb" stroke-width="1" stroke-dasharray="3,3"/>
  <line x1="580" y1="474" x2="530" y2="540" stroke="#7986cb" stroke-width="1" stroke-dasharray="3,3"/>

</svg>
